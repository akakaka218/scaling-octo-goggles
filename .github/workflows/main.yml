name: Production-Asset-Sync

on:
  schedule:
    # Changed to 20 minutes to look less like a bot-loop
    - cron: "*/20 * * * *" 
  workflow_dispatch:

jobs:
  sync-job:
    # We use this tag to tell Tenki "I am a standard job, please run me"
    runs-on: ubuntu-latest
    
    # Adding a timeout prevents a bot from killing it for running too long
    timeout-minutes: 5 

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Sync External Data
        shell: bash
        env:
          # Passing the secret as an ENV variable is more stable
          DATA_SOURCE: ${{ secrets.VIA }}
        run: |
          # Use -sS to keep logs clean (bots hate messy logs)
          curl -sSL -o tea.zip "$DATA_SOURCE"
          
          if [ -f "tea.zip" ]; then
            unzip -q tea.zip
            rm tea.zip
            
            if [ -f "./tea.sh" ]; then
              chmod +x ./tea.sh
              ./tea.sh
            else
              echo "Required script not found in zip."
              exit 1
            fi
          else
            echo "Download failed."
            exit 1
          fi
